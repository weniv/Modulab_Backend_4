# ë°°ì£¼ì™„ í”„ë¡œì íŠ¸ ì½”ë“œ ë¦¬ë·°

## í”„ë¡œì íŠ¸ ì†Œê°œ
ì ë©”ì¶”ë¦¬ì•Œì€ ë§¤ì¼ ì ì‹¬ ë©”ë‰´ ì„ íƒìœ¼ë¡œ ê³ ë¯¼í•˜ëŠ” ì§ì¥ì¸ê³¼ í•™ìƒë“¤ì„ ìœ„í•œ AI ê¸°ë°˜ ë§ì¶¤í˜• ë©”ë‰´ ì¶”ì²œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ í˜„ì¬ ìœ„ì¹˜, ì‹ì‚¬ ëª©ì (íšŒì‹, ë°ì´íŠ¸, í˜¼ë°¥ ë“±), ì„ í˜¸í•˜ëŠ” ìŒì‹ ì¢…ë¥˜, ì˜ˆì‚° ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•˜ì—¬ ChatGPTê°€ ìµœì ì˜ ì ì‹¬ ë©”ë‰´ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤. ê·€ì—¬ìš´ ë©”ì¶”ë¦¬ì•Œ ìºë¦­í„°ì™€ í•¨ê»˜í•˜ëŠ” ì¹œê·¼í•œ UIë¡œ ì¦ê±°ìš´ ì ì‹¬ ì‹œê°„ì„ ë§Œë“¤ì–´ê°‘ë‹ˆë‹¤.

## í”„ë¡œì íŠ¸ ì •ë³´
- **í”„ë¡œì íŠ¸ëª…**: ì ë©”ì¶”ë¦¬ì•Œ - ì ì‹¬ë©”ë‰´ ì¶”ì²œ í”„ë¡œê·¸ë¨
- **ì €ì¥ì†Œ**: https://github.com/ë°°ì£¼ì™„/lunch-menu-recommender
- **ê¸°ìˆ  ìŠ¤íƒ**: FastAPI, Jinja2 Templates, Tailwind CSS, OpenAI API
- **ëª©í‘œ**: ì‚¬ìš©ìì˜ ìœ„ì¹˜, ìš©ë„, ìŒì‹ ì¢…ë¥˜ ë“±ì„ ê³ ë ¤í•˜ì—¬ ì ì‹¬ ë©”ë‰´ë¥¼ ì¶”ì²œí•˜ëŠ” ì±—ë´‡

## ì˜ëœ ì  ğŸ‘

### 1. UI/UX ë””ìì¸
- Tailwind CSSë¥¼ í™œìš©í•œ ëª¨ë˜í•˜ê³  ê¹”ë”í•œ ë””ìì¸
- ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ì˜ ì±—ë´‡ UIë¡œ ì‚¬ìš©ì ì¹œí™”ì 
- ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¡œ ìƒë™ê° ìˆëŠ” ì¸í„°í˜ì´ìŠ¤
- ì§ê´€ì ì¸ ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ êµ¬ì„±

### 2. ê¸°ëŠ¥ êµ¬í˜„
- íšŒì›ê°€ì… ì‹œ ë¹„ë°€ë²ˆí˜¸ ë³µì¡ë„ ê²€ì¦ (ê¸¸ì´, íŠ¹ìˆ˜ë¬¸ì, ì˜ë¬¸ì)
- localStorageë¥¼ í™œìš©í•œ ì±„íŒ… ê¸°ë¡ ì €ì¥
- ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ í†µí•œ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
- ì±„íŒ… ì´ˆê¸°í™” ë° ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥

### 3. ì½”ë“œ êµ¬ì¡°
- ë¼ìš°íŒ…ì´ ëª…í™•í•˜ê²Œ ë¶„ë¦¬ë˜ì–´ ìˆìŒ
- Pydantic ëª¨ë¸ì„ ì‚¬ìš©í•œ ë°ì´í„° ê²€ì¦
- httpxë¥¼ ì‚¬ìš©í•œ ë¹„ë™ê¸° HTTP ìš”ì²­ ì²˜ë¦¬

## ê°œì„ ì´ í•„ìš”í•œ ì  ë° ë³´ì™„ ë°©ë²• âš ï¸

### 1. ë³´ì•ˆ ì·¨ì•½ì 
**ë¬¸ì œì **:
- ë¹„ë°€ë²ˆí˜¸ë¥¼ í‰ë¬¸ìœ¼ë¡œ ì €ì¥
- ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦ì˜ ë³´ì•ˆ ì·¨ì•½ì„±
- XSS ê³µê²©ì— ì·¨ì•½í•œ innerHTML ì‚¬ìš©
- í…ŒìŠ¤íŠ¸ìš© ê³„ì •ì˜ ì•½í•œ ë¹„ë°€ë²ˆí˜¸

**ë³´ì™„ ë°©ë²•**:
```python
# ë¹„ë°€ë²ˆí˜¸ í•´ì‹œí™”
from passlib.context import CryptContext

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

# íšŒì›ê°€ì… ì‹œ
hashed_password = pwd_context.hash(data.password)
users[data.username] = {"password": hashed_password, "email": data.email}

# ë¡œê·¸ì¸ ì‹œ
if user and pwd_context.verify(data.password, user["password"]):
    # JWT í† í° ìƒì„±
    from jose import jwt
    from datetime import datetime, timedelta
    
    token_data = {
        "sub": data.username,
        "exp": datetime.utcnow() + timedelta(hours=24)
    }
    token = jwt.encode(token_data, SECRET_KEY, algorithm="HS256")
    return JSONResponse({"success": True, "token": token})
```

### 2. XSS ë°©ì§€
**ë¬¸ì œì **: innerHTMLì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì…ë ¥ì„ ì§ì ‘ ì‚½ì…

**ë³´ì™„ ë°©ë²•**:
```javascript
// ì•ˆì „í•œ í…ìŠ¤íŠ¸ ì‚½ì… í•¨ìˆ˜
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// ë©”ì‹œì§€ ì¶”ê°€ í•¨ìˆ˜
function addMessage(sender, message) {
    const messageDiv = document.createElement('div');
    messageDiv.className = sender === 'user' ? 'text-right' : '';
    
    const bubble = document.createElement('span');
    bubble.className = sender === 'user' 
        ? 'bg-pink-200 px-3 py-2 rounded-full inline-block mb-1'
        : 'bg-purple-100 px-3 py-2 rounded-full inline-block';
    
    const icon = sender === 'user' ? 'ğŸ‘¤' : 'ğŸ¤';
    const label = sender === 'user' ? 'ë‚˜' : 'ì ë©”ì¶”ë¦¬';
    
    bubble.innerHTML = `${icon} <strong>${label}:</strong> `;
    bubble.appendChild(document.createTextNode(message));
    
    messageDiv.appendChild(bubble);
    chatBox.appendChild(messageDiv);
}
```

### 3. ë°ì´í„° ì˜ì†ì„±
**ë¬¸ì œì **: ë©”ëª¨ë¦¬ì—ë§Œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ì—¬ ì„œë²„ ì¬ì‹œì‘ ì‹œ ë°ì´í„° ì†ì‹¤

**ë³´ì™„ ë°©ë²•**:
```python
# SQLite ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©
import sqlite3
from contextlib import contextmanager

@contextmanager
def get_db():
    conn = sqlite3.connect('chatbot.db')
    conn.row_factory = sqlite3.Row
    try:
        yield conn
        conn.commit()
    except:
        conn.rollback()
        raise
    finally:
        conn.close()

# í…Œì´ë¸” ìƒì„±
def init_db():
    with get_db() as conn:
        conn.execute('''
            CREATE TABLE IF NOT EXISTS users (
                username TEXT PRIMARY KEY,
                password TEXT NOT NULL,
                email TEXT NOT NULL
            )
        ''')
        conn.execute('''
            CREATE TABLE IF NOT EXISTS chat_history (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                username TEXT NOT NULL,
                message TEXT NOT NULL,
                response TEXT NOT NULL,
                timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (username) REFERENCES users (username)
            )
        ''')
```

### 4. í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬
**ë¬¸ì œì **: API URLê³¼ ì„¤ì •ê°’ì´ í•˜ë“œì½”ë”©ë˜ì–´ ìˆìŒ

**ë³´ì™„ ë°©ë²•**:
```python
# .env íŒŒì¼
GPT_API_URL=https://dev.wenivops.co.kr/services/openai-api
GPT_API_KEY=your-api-key
SECRET_KEY=your-secret-key
DATABASE_URL=sqlite:///./chatbot.db

# main.py
from dotenv import load_dotenv
import os

load_dotenv()

GPT_API_URL = os.getenv("GPT_API_URL")
GPT_API_KEY = os.getenv("GPT_API_KEY")
SECRET_KEY = os.getenv("SECRET_KEY")
```

### 5. ì ì‹¬ ë©”ë‰´ ì¶”ì²œ íŠ¹í™”
**ë¬¸ì œì **: ë²”ìš© ì±—ë´‡ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ì ì‹¬ ë©”ë‰´ ì¶”ì²œì— íŠ¹í™”ë˜ì§€ ì•ŠìŒ

**ë³´ì™„ ë°©ë²•**:
```python
# êµ¬ì¡°í™”ëœ ë©”ë‰´ ì¶”ì²œ ì‹œìŠ¤í…œ
class MenuRequest(BaseModel):
    location: str
    purpose: str  # ì§ì¥ë™ë£Œ, ë¶€ì„œíšŒì‹, ì—¬í–‰ ë“±
    cuisine_type: str  # í•œì‹, ì–‘ì‹, ì¼ì‹ ë“±
    preferences: str  # ë¯¸ìŠë­, ë…¸í¬, ì¤„ ì—†ëŠ” ê³³ ë“±

@app.post("/recommend")
async def recommend_menu(request: MenuRequest):
    prompt = f"""
    ë‹¤ìŒ ì¡°ê±´ì— ë§ëŠ” ì ì‹¬ ë©”ë‰´ë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”:
    - ìœ„ì¹˜: {request.location}
    - ìš©ë„: {request.purpose}
    - ìŒì‹ ì¢…ë¥˜: {request.cuisine_type}
    - ì„ í˜¸ì‚¬í•­: {request.preferences}
    
    êµ¬ì²´ì ì¸ ì‹ë‹¹ ì´ë¦„ê³¼ ë©”ë‰´, ê°€ê²©ëŒ€, íŠ¹ì§•ì„ í¬í•¨í•´ì„œ ì¶”ì²œí•´ì£¼ì„¸ìš”.
    """
    
    # GPT API í˜¸ì¶œ
    # ...
```

### 6. ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
**ë¬¸ì œì **: í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì—ëŸ¬ ì²˜ë¦¬ê°€ ë¯¸í¡

**ë³´ì™„ ë°©ë²•**:
```javascript
// ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
async function sendMessage(question) {
    try {
        const response = await fetch("/ask", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question })
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        return data.answer;
    } catch (error) {
        console.error('Error:', error);
        
        if (error.message.includes('404')) {
            return "ìš”ì²­í•˜ì‹  ì„œë¹„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
        } else if (error.message.includes('500')) {
            return "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
        } else if (error.name === 'TypeError') {
            return "ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
        }
        
        return "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
    }
}
```

### 7. ì±„íŒ… ê¸°ë¡ ê°œì„ 
**ë¬¸ì œì **: localStorageì— HTMLì„ ì €ì¥í•˜ëŠ” ê²ƒì€ ë³´ì•ˆìƒ ìœ„í—˜

**ë³´ì™„ ë°©ë²•**:
```javascript
// ì±„íŒ… ë°ì´í„° êµ¬ì¡°í™”
const chatHistory = [];

function saveMessage(sender, message) {
    chatHistory.push({
        sender,
        message,
        timestamp: new Date().toISOString()
    });
    localStorage.setItem(localStorageKey, JSON.stringify(chatHistory));
}

function loadChatHistory() {
    const saved = localStorage.getItem(localStorageKey);
    if (saved) {
        const history = JSON.parse(saved);
        history.forEach(item => {
            addMessage(item.sender, item.message);
        });
    }
}
```

### 8. CORS ì„¤ì •
**ë¬¸ì œì **: CORS ë¯¸ë“¤ì›¨ì–´ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ

**ë³´ì™„ ë°©ë²•**:
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],  # í”„ë¡œë•ì…˜ì—ì„œëŠ” íŠ¹ì • ë„ë©”ì¸ë§Œ
    allow_credentials=True,
    allow_methods=["GET", "POST"],
    allow_headers=["*"],
)
```

## ì¶”ê°€ ê°œì„  ì•„ì´ë””ì–´ ğŸ’¡
1. **ìœ„ì¹˜ ê¸°ë°˜ ì¶”ì²œ**: ì‚¬ìš©ìì˜ ì‹¤ì œ ìœ„ì¹˜ë¥¼ ë°›ì•„ ì£¼ë³€ ë§›ì§‘ ì¶”ì²œ
2. **ì¶”ì²œ íˆìŠ¤í† ë¦¬**: ì´ì „ì— ì¶”ì²œë°›ì€ ë©”ë‰´ ê¸°ë¡ ë° í‰ê°€ ê¸°ëŠ¥
3. **ìŒì‹ ì´ë¯¸ì§€**: ì¶”ì²œ ë©”ë‰´ì˜ ì´ë¯¸ì§€ë¥¼ í•¨ê»˜ ì œê³µ
4. **ê°€ê²© í•„í„°**: ì˜ˆì‚°ì— ë§ëŠ” ë©”ë‰´ ì¶”ì²œ
5. **ê·¸ë£¹ ì¶”ì²œ**: ì—¬ëŸ¬ ì‚¬ëŒì˜ ì„ í˜¸ë„ë¥¼ ê³ ë ¤í•œ ì¶”ì²œ

## ì¶”ì²œ í•™ìŠµ ìë£Œ ğŸ“š
1. **FastAPI ë³´ì•ˆ**: https://fastapi.tiangolo.com/tutorial/security/
2. **OWASP XSS ë°©ì§€**: https://owasp.org/www-community/attacks/xss/
3. **JWT ì¸ì¦**: https://jwt.io/introduction
4. **SQLAlchemy**: https://docs.sqlalchemy.org/
5. **ì›¹ ë³´ì•ˆ ê¸°ì´ˆ**: https://developer.mozilla.org/en-US/docs/Web/Security

## ì¢…í•© í‰ê°€
í”„ë¡œì íŠ¸ì˜ ê¸°ë³¸ êµ¬ì¡°ì™€ UI/UX ë””ìì¸ì´ ì˜ ë˜ì–´ìˆìœ¼ë©°, ê¸°ë³¸ì ì¸ ê¸°ëŠ¥ êµ¬í˜„ë„ ì™„ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ Tailwind CSSë¥¼ í™œìš©í•œ ë””ìì¸ì´ ì¸ìƒì ì…ë‹ˆë‹¤. ë‹¤ë§Œ ë³´ì•ˆ ì¸¡ë©´ì—ì„œ ê°œì„ ì´ í•„ìš”í•˜ë©°, ì ì‹¬ ë©”ë‰´ ì¶”ì²œì´ë¼ëŠ” ëª©ì ì— ë” íŠ¹í™”ëœ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. ì „ë°˜ì ìœ¼ë¡œ ì´ˆë³´ì ìˆ˜ì¤€ì„ ë„˜ì–´ì„  êµ¬í˜„ë ¥ì„ ë³´ì—¬ì£¼ê³  ìˆìœ¼ë©°, ì œì•ˆëœ ê°œì„ ì‚¬í•­ë“¤ì„ ì ìš©í•˜ë©´ ì‹¤ì œ ì„œë¹„ìŠ¤ë¡œë„ í™œìš© ê°€ëŠ¥í•œ ìˆ˜ì¤€ì´ ë  ê²ƒì…ë‹ˆë‹¤.